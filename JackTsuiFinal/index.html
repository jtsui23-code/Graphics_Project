<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <title>WebGL Dungeon Final Project</title>
    <style>
        body { background-color: #222; color: #eee; font-family: sans-serif; }
        canvas { background-color: #000; display: block; margin: 0 auto; border: 2px solid #555; }
        .controls { text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<canvas id="gl-canvas" width="800" height="600">
    Oops ... your browser doesn't support the HTML5 canvas element
</canvas>

<div class="controls">
    <h3>Dungeon Explorer</h3>
    <p>Find the purple torch to win</p>
    <p><strong>Movement:</strong> W/A/S/D keys</p>
    <p><strong>Look:</strong> Arrow Keys</p>
    <button id="toggleAnim">Pause/Resume Animation</button>
</div>


<script id="vertex-shader" type="x-shader/x-vertex">
#version 300 es

in  vec4 aPosition;
in  vec3 aNormal;


in  vec4 aColor; 

out vec4 vColor;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform mat3 uNormalMatrix; 

// Light
uniform vec4 uLightPosition; 
uniform vec3 uAmbientProduct;
uniform vec3 uDiffuseProduct;
uniform vec3 uSpecularProduct;

uniform float uShininess;

void main()
{
    // Transform vertex position to eye coordinates
    vec3 pos = (uModelView * aPosition).xyz;

    // Transform vertex normal to eye coordinates
    vec3 N = normalize(uNormalMatrix * aNormal);

    // Vector to Light Source
    // If w=0, it's a directional light, so L is just the direction
    // If w=1, it's a point light, so L = LightPos - VertexPos
    vec3 L;
    if(uLightPosition.w == 0.0) {
        L = normalize(uLightPosition.xyz);
    } else {
        L = normalize(uLightPosition.xyz - pos);
    }

    // Vector to Viewer (Eye is at 0,0,0 in eye coords)
    vec3 E = normalize(-pos);

    vec3 H = normalize(L + E);

    float Kd = max(dot(L, N), 0.0);
    vec3  diffuse = Kd * uDiffuseProduct;

    float Ks = pow(max(dot(N, H), 0.0), uShininess);
    vec3  specular = Ks * uSpecularProduct;
    if(dot(L, N) < 0.0) specular = vec3(0.0, 0.0, 0.0);

    vec3 ambient = uAmbientProduct;

    // Final color
    vColor = vec4(ambient + diffuse + specular, 1.0);

    gl_Position = uProjection * uModelView * aPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
#version 300 es

precision mediump float;

in vec4 vColor;
out vec4 fColor;

void main()
{
    fColor = vColor;
}
</script>


<script src="Common/initShaders.js"></script>
<script src="Common/MVnew.js"></script>
<script src="final.js"></script>

</body>
</html>